<div id="myid-my-account-wrapper">
    
<form (ngSubmit)="updateAccountData()" [formGroup]="updateAccountDataForm">
    <div class="form-group">
        <label for="firstName">First name</label>
        <!-- Da bi mogao da stavim odredjenu sirinu input polja (da mi ne ide preko celog ekrana ko po defaultu) po onom sto pise u dokumentaciji i sto se preporucuje i ovde https://www.w3schools.com/bootstrap4/bootstrap_forms_sizing.asp to treba raditi sa dodavanjem col klasa. E sad one bi trebalo da su u divu koji ima row klasu. E da, ali ti kad dodas row klasu, on ti doda negativne margine i to ovde rezultira da ti nisu label i input polje poravnati, vec input polje strci ulevo za 15px. I da bi se to anuliralo tj ponistilo nasao sam ovu foru da ga strpam u div sa container klasom (vidi https://medium.com/@evidanary/fixing-negative-margins-in-bootstrap-til-ebe3f6b8a6ec , https://stackoverflow.com/questions/18969051/bootstrap-3-why-is-row-class-is-wider-than-its-container). Ima jos fora da se to resi naravno, al mi se ova bar zasad cini najpouzdanijom -->
        <div class="container myclass-input-container-class">
            <div class="row">
                <input #firstNameInput type="text" name="firstName" id="firstName" class="form-control col-8 col-sm-6 col-md-5" formControlName="firstName" readonly="readonly" (blur)="inputBlurHandler($event)">
                &nbsp;&nbsp;<button #btnChangeFirstName *ngIf="userDataReceived" (click)="changeInputToggle($event)" type="button" id="btnChangeFirstName" class="btn btn-success">Change</button>
            </div>
            <div class="row">
                <div *ngIf="firstName.invalid && (firstName.dirty || firstName.touched)" class="alert alert-danger col-8 col-sm-6 col-md-5">
                    <div *ngIf="firstName.errors.required || firstName.errors.pattern">
                        Please fill this field or press cancel.
                    </div>
                    <div *ngIf="firstName.errors.sameValue">
                        You can not enter the same value.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="form-group">
        <label for="lastName">Last name</label>
        <div class="container myclass-input-container-class">
            <div class="row">
                <input #lastNameInput type="text" name="lastName" id="lastName" class="form-control col-8 col-sm-6 col-md-5" formControlName="lastName" readonly (blur)="inputBlurHandler($event)">
                &nbsp;&nbsp;<button #btnChangeLastName *ngIf="userDataReceived" (click)="changeInputToggle($event)" type="button" id="btnChangeLastName" class="btn btn-success">Change</button>
            </div>
            <div class="row">
                <div *ngIf="lastName.invalid && (lastName.dirty || lastName.touched)" class="alert alert-danger col-8 col-sm-6 col-md-5">
                    <div *ngIf="lastName.errors.required || lastName.errors.pattern">
                        Please fill this field or press cancel.
                    </div>
                    <div *ngIf="lastName.errors.sameValue">
                        You can not enter the same value.
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="form-group">
        <label for="email">Email</label>
        <div class="container myclass-input-container-class">
            <div class="row">
                <input #emailInput type="email" name="email" id="email" class="form-control col-8 col-sm-6 col-md-5" formControlName="email" readonly (blur)="inputBlurHandler($event)">
                &nbsp;&nbsp;<button #btnChangeEmail *ngIf="userDataReceived" (click)="changeInputToggle($event)" type="button" id="btnChangeEmail" class="btn btn-success">Change</button>
            </div>
            <div class="row">
                <div *ngIf="email.invalid && (email.dirty || email.touched)" class="alert alert-danger col-8 col-sm-6 col-md-5">
                    <div *ngIf="email.errors.required || email.errors.pattern">
                        Please fill this field or press cancel.
                    </div>
                    
                    <!-- Ovde moze da stoji ovaj dupli uslov, nekad to nije dobro jer ti se uslov iz parrent diva sa klasama alert alert-danger zadovolji a ne zadovolji ti se nijedan od pojedinacnih child divova i onda ti se na stranici pojavi prazan crveni div bez poruke-->
                    <div *ngIf="email.errors.email && email.dirty">
                        Please provide valid email address.
                    </div>

                    <div *ngIf="email.errors.sameValue">
                        You can not enter the same value.
                    </div>
                </div>
            </div>
        </div>
    </div>

    

    <div #passwordChangeContainer class="myclass-password-change-container" formGroupName="changePassword">
        
        <div class="form-group">
            <label for="password">Password</label>
            <div class="container myclass-input-container-class">
                <div class="row">
                    <input #passwordInput type="password" name="password" id="password" class="form-control col-8 col-sm-6 col-md-5" formControlName="password" (blur)="inputBlurHandler($event)">
                </div>
                <div class="row">
                    <div *ngIf="password.invalid && (password.dirty || password.touched)" class="alert alert-danger col-8 col-sm-6 col-md-5">
                        <div *ngIf=" password.errors.required ">
                           Please fill in this field or press cancel
                        </div>
                        <ng-container *ngIf="password.dirty">
                          <div *ngIf=" password.errors.minlength ">
                             Password must be at least 8 chars
                          </div>
                          <div *ngIf=" password.errors.pattern ">
                             Password must contain at least one number
                          </div>
                        </ng-container>
                    </div>
                    
                </div>
            </div>
        </div>
        
        <div class="form-group">
            <label for="password_confirmation">Confirm password</label>
            <div class="container myclass-input-container-class">
                <div class="row">
                    <input #confirmPasswordInput type="password" name="password_confirmation" id="password_confirmation" class="form-control col-8 col-sm-6 col-md-5" formControlName="confirmPassword" (blur)="inputBlurHandler($event)">
                </div>
            </div>

            <div class="container myclass-error-container-class">
              <div class="row">

                  <div *ngIf="(confirmPassword.invalid || confirmPassword.value !== password.value) && (confirmPassword.touched || confirmPassword.dirty)" class="alert alert-danger col-8 col-md-6 col-lg-5">
                    
                     <div *ngIf="confirmPassword.invalid && confirmPassword.errors.required ">
                        Please fill in this field or press cancel
                     </div>
                      
                     <div *ngIf="confirmPassword.dirty && confirmPassword.value !== password.value">
                        Confirmed password is not the same password
                     </div>

                  </div>

              </div>
            </div>

        </div>

    </div>

    <div class="form-group">
        <button #btnChangePassword *ngIf="userDataReceived" type="button" id="btnChangePassword" class="btn btn-success" (click)="togglePasswordChangeContainer()">Change your password</button>
    </div>




    <div *ngIf="loggedUserExsistingProfileImage" id="loggedUserExsistingProfileImageContainer">
        <img id="loggedUserExsistingProfileImage" src="{{loggedUserExsistingProfileImage}}">
        <p>Your current profile image</p>
    </div>

    <!-- ************** Image Cropper ************* -->

    <div id="myid-image-upload-wrapper">
        <label for="myid-choose-profile-image" *ngIf="!loggedUserExsistingProfileImage; else changeImage">Add your profile image</label>
        <ng-template #changeImage>
            <label for="myid-choose-profile-image">Change your profile image</label>
        </ng-template>
        <div>
            <input type="file" accept="image/*" id="myid-choose-profile-image" class="btn btn-light" (change)="fileChangeEvent($event)" formControlName="profileImage"/>
            
            <button type="button" id="myid-clear-profile-image" class="btn btn-dark" *ngIf="imageChangedEvent || croppedImage" (click)="clearImage()">Clear image</button>
        </div>

        <div #uploadImageErrorDiv [hidden]="!uploadImageError" class="alert alert-danger myclass-upload-image-error">
          {{uploadImageError}}
        </div>

        <div id="myid-image-cropper-container">
            <image-cropper
                [imageChangedEvent]="imageChangedEvent"
                [maintainAspectRatio]="true"
                [aspectRatio]="1 / 1"
                [resizeToWidth]="128"
                format="png"
                (imageCropped)="imageCropped($event)"
                (imageLoaded)="imageLoaded()"
                (loadImageFailed)="loadImageFailed()"
            ></image-cropper>
        </div>
        <div *ngIf="croppedImage" id="myid-cropped-image-container">
            <p>
                You can crop the image with handles.<br>
                It will look like this:
            </p>
            <!-- ovde stavljam [style.borderRadius]="'50%'" cisto da vidis sintaksu kako se pise, inace mogao je komotno ovde da ide samo style atribut-->
            <img [src]="croppedImage" [style.borderRadius]="'50%'"/>
        </div>
    </div>
    <!-- ****************************************** -->

    <button type="submit" class="btn btn-primary btn-block" [disabled]="!userDataReceived || updateAccountDataForm.invalid || !formDataChanged || confirmPassword.value !== password.value">Submit changes</button>

</form>

<!-- Posto je zajebano otvarati modal iz angularovog koda, morao il rucno da dodajem klase, atribute i ko zna sta jos, ili bi morao na neki hacky nacin da ubacujem jquery, najlakse je zapravo simulirati klik na ovo sakriveno dugme -->
<button #passwordModalButtonTrigger type="button" [hidden]="true" class="btn btn-primary" data-toggle="modal" data-target="#exampleModal">
  Launch modal
</button>


<!-- Bootstrap modal -->
<div #passwordModal class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true" data-backdrop="static"><!-- Da zabranis modalu da se zatvara na klik van njega, treba da mu zadas  data-backdrop="static"-->
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Please reenter your password</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <p>When changing sensitive data like name, email or password, we need to be sure it is actually YOU who is changing this data, so you need to provide us your <strong>password</strong> with which you are currently logged in, and <strong>confirmation</strong> via the email that we will send you!</p>
        <hr>
        <form [formGroup]="updateAccountDataForm" (ngSubmit)="updateAccountDataWithReEnteredPassword()">
          <div class="form-group">
            <label for="reEnteredPassword" class="col-form-label">Password:</label>
            <!-- Ovaj formControlName ne moze da stoji ovde ako u ts kodu ti nisi definisao form control sa tim imenom unutar forme. E sad ti ga dodajes kasnije dinamicki i zato ovde imas onda u startu error. Da se to ne bi desavalo moram ovaj ngIf ovde da stavim, a foru sam pokupio ovde https://stackoverflow.com/questions/49266469/angular-reactive-forms-adding-and-removing-fields  -->
            <input *ngIf="updateAccountDataForm.get('reEnteredPassword')" type="password" class="form-control" id="reEnteredPassword" formControlName="reEnteredPassword">
          </div>
          <button type="submit" class="btn btn-primary">Submit</button>
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        </form>
      </div>
      <!-- <div class="modal-footer">
        
      </div> -->
    </div>
  </div>
</div>

</div>
